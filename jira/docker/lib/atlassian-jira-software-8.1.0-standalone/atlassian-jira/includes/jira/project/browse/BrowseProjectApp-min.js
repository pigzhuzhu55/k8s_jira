define("jira/project/browse/app",["require"],function(e){"use strict";var t=e("underscore"),i=e("jquery"),o=e("backbone"),r=e("marionette"),s=e("jira/project/browse/layout"),a=e("jira/project/browse/tabsview"),c=e("jira/project/browse/projecttypestabsview"),n=e("jira/project/browse/projectcollection"),l=e("jira/project/browse/projectcollectionview"),p=e("jira/project/browse/paginationview"),g=e("jira/project/browse/filtermodel"),j=e("jira/project/browse/filterview"),h=e("jira/util/navigation"),w=e("jira/project/browse/categorycollection"),y=e("jira/project/browse/projecttypecollection"),u=e("jira/util/users/logged-in-user"),d=e("jira/util/data/meta"),v=new r.Application;return v.on("start",function(e){var r=e.container;this.categories=new w(e.categories),this.availableProjectTypes=new y(e.availableProjectTypes),this.projects=new n(e.projects,{mode:"client",state:{pageSize:25,currentPage:1},categories:this.categories}),this.categories.selectCategory(e.selectedCategory),e.availableProjectTypes?(this.availableProjectTypes.selectProjectType(e.selectedProjectType)||this.availableProjectTypes.selectProjectType("all"),this.filter=new g({category:this.categories.getSelected().toJSON(),projectType:this.availableProjectTypes.getSelected().toJSON()},{pageableCollection:this.projects})):this.filter=new g({category:this.categories.getSelected().toJSON()},{pageableCollection:this.projects}),this.layout=new s({el:r}),this.projectCollectionView=new l({model:this.filter,collection:this.projects});var b=function(e){var t=v.categories.getSelected().id,i=v.categories.selectCategory(e);i&&(v.filter.changeCategory(i),"archived"!==e&&"archived"!==t||v.projectCollectionView.render())};d.get("in-admin-mode")&&i(this.layout.sidebar.el).addClass("hidden"),""!==u.username()||this.categories.length>1?(this.tabsView=new a({collection:this.categories}),this.tabsView.on("category-change",b),this.layout.categoryNav.show(this.tabsView)):this.layout.$el.find(this.layout.categoryNav.el).addClass("hidden");var f=function(e){var t=v.availableProjectTypes.selectProjectType(e);t&&v.filter.changeProjectType(t)};if(this.availableProjectTypes.length>0?(this.projectTypesTabsView=new c({collection:this.availableProjectTypes}),this.projectTypesTabsView.on("project-type-change",f),this.layout.projectTypeNav.show(this.projectTypesTabsView)):this.layout.$el.find(".project-type-nav").addClass("hidden"),this.projectCollectionView.on("project-view.click-category",function(e){b(e.attributes.projectCategoryId)}),this.layout.content.show(this.projectCollectionView),this.layout.pagination.show(new p({collection:this.projects,model:this.filter})),this.layout.filter.show(new j({model:this.filter})),this.layout.pagination.currentView.on("navigate",function(e){var i=t.extend(v.filter.getQueryParams(!1),{page:e});h.navigate(i)}),this.projectCollectionView.on("sorted",function(e,i){var o=t.extend(v.filter.getQueryParams(!1),{sortColumn:e,sortOrder:i});h.navigate(o)}),this.filter.on("filter",function(e){h.navigate(e)}),(new(o.Router.extend({initialize:function(){this.route(/(.*)/,"every")}}))).on("route:every",function(){var e=+h.getParam("page",!0)||1,t=h.getParam("contains",!0)||"",i=h.getParam("selectedCategory")||"",o=h.getParam("sortColumn")||"",r=h.getParam("sortOrder")||"",s=v.categories.selectCategory(i),a=h.getParam("selectedProjectType")||"",c=v.availableProjectTypes.selectProjectType(a);v.filter.set("contains",t,{silent:!0}),!1!==s&&v.filter.set("category",s.toJSON(),{silent:!0}),!1!==c&&v.filter.set("projectType",c.toJSON(),{silent:!0}),v.projectCollectionView.model.set("sortColumn",o),v.projectCollectionView.model.set("sortOrder",r),r&&o&&(v.projects.updateSorting(o,r),v.projectCollectionView.render()),v.filter.filterCollection(),v.projects.getPage(e),v.layout.filter.currentView.render()}),o.History.started||o.history.start({pushState:h.pushStateSupported,root:h.getBackboneHistoryRoot()}),window.location.hash){var T=window.location.hash.substring(1);this.categories.get(T)&&b(T)}this.listenTo(this.projectCollectionView,{"project-view.click-project-name":function(e,t){this.trigger("browse-projects.project-view.click-project-name",e,t)},"project-view.click-lead-user":function(e,t){this.trigger("browse-projects.project-view.click-lead-user",e,t)},"project-view.click-category":function(e,t){this.trigger("browse-projects.project-view.click-category",e,t)},"project-view.click-url":function(e,t){this.trigger("browse-projects.project-view.click-url",e,t)}}),void 0!==this.projectTypesTabsView&&this.listenTo(this.projectTypesTabsView,{"project-type-change":function(e){this.trigger("browse-projects.project-type-change",e)}}),void 0!==this.tabsView&&this.listenTo(this.tabsView,{"category-change":function(e){this.trigger("browse-projects.category-change",e)}}),this.listenTo(this.filter,{filter:function(){var e=v.projects.length;this.trigger("browse-projects.projects-render",e)}}),this.listenTo(this.layout.pagination.currentView,{navigate:function(e){this.trigger("browse-projects.navigate-to-page",e)},"navigate-previous":function(){this.trigger("browse-projects.navigate-to-previous")},"navigate-next":function(){this.trigger("browse-projects.navigate-to-next")}})}),v});