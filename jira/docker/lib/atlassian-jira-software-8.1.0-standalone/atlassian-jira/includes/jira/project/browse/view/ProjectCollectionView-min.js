define("jira/project/browse/projectcollectionview",["jira/analytics","jira/util/formatter","jira/util/data/meta","marionette","jquery","jira/project/browse/projectview","jira/project/browse/projecttypesservice","jira/project/project-type-keys","jira/util/users/logged-in-user","jira/util/data/meta"],function(e,t,i,r,o,s,c,n,a,l){"use strict";return r.CompositeView.extend({template:function(e){return e.isAdmin=a.isSysadmin()||a.isAdmin(),e.isAdminMode=l.get("in-admin-mode"),JIRA.Templates.Project.Browse.projects(e)},sort:function(e){"ascending"===this.model.get("sortOrder")&&this.model.get("sortColumn")===e?this.model.set("sortOrder","descending"):(this.model.set("sortOrder","ascending"),this.model.set("sortColumn",e)),this.collection.updateSorting(e,this.model.get("sortOrder")),this.trigger("sorted",e,this.model.get("sortOrder")),this.render()},events:{"click th.sortable":function(e){this.sort(o(e.currentTarget).data("sort-key"))}},itemView:s,itemViewOptions:function(){return{filters:this.model,hasArchivedProjects:!!this.model.filterByCategory("archived",this.collection.originalCollection).length}},itemEvents:{"project-view.click-project-name":function(e,t,i){var r=this.collection.indexOf(i);this.trigger("project-view.click-project-name",i,r)},"project-view.click-lead-user":function(e,t,i){var r=this.collection.indexOf(i);this.trigger("project-view.click-lead-user",i,r)},"project-view.click-category":function(e,t,i){var r=this.collection.indexOf(i);this.trigger("project-view.click-category",i,r)},"project-view.click-url":function(e,t,i){var r=this.collection.indexOf(i);this.trigger("project-view.click-url",i,r)}},emptyView:r.ItemView.extend({events:{"click .empty-state-add-project-button":"_handleAddProjectClicked"},shouldUseCallToActionTemplate:function(){var e=[n.SOFTWARE,n.SERVICE_DESK,n.BUSINESS];return this.options.filters.get("projectType")&&"all"===this.options.filters.get("category").id&&""===this.options.filters.get("contains")&&-1!==e.indexOf(this.options.filters.get("projectType").key)},getTemplate:function(){return this.options.hasArchivedProjects||"archived"!==this.options.filters.get("category").id?this.shouldUseCallToActionTemplate()?JIRA.Templates.Project.Browse.emptyRowWithCallToAction:JIRA.Templates.Project.Browse.emptyRow:JIRA.Templates.Project.Browse.archivedProjectsEmptyState},onRender:function(){this.unwrapTemplate()},_handleAddProjectClicked:function(t){e.send({name:"projects.browse.empty.state.add.projects.clicked",properties:{projectTypeKey:o(t.target).data("project-type")}})},serializeData:function(){var e={};if(this.shouldUseCallToActionTemplate()){var r=this.options.filters.get("projectType").key;r===n.SOFTWARE?e={headerText:t.I18n.getText("browse.projects.software.projects.title"),descriptionText:t.I18n.getText("browse.projects.software.projects.description"),callToActionText:t.I18n.getText("browse.projects.create.new.project.link"),projectType:r}:r===n.SERVICE_DESK?e={headerText:t.I18n.getText("browse.projects.servicedesk.projects.title"),descriptionText:t.I18n.getText("browse.projects.servicedesk.projects.description"),callToActionText:t.I18n.getText("browse.projects.create.new.project.link"),projectType:r}:r===n.BUSINESS&&(e={imageClassName:"create-business-project-image",headerText:t.I18n.getText("browse.projects.business.projects.not.created"),descriptionText:t.I18n.getText("browse.projects.business.projects.description"),callToActionText:t.I18n.getText("browse.projects.create.new.project.link"),projectType:r})}return o.extend({isAdmin:i.get("is-admin"),adminMode:l.get("in-admin-mode")},e)}}),itemViewContainer:"tbody",onRender:function(){this.unwrapTemplate()}})});